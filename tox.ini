# tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
isolated_build = true
envlist = py39, py310, py311, py312, py313, black, mypy, ruff, doc

[testenv:{py39,py310,py311,py312,py313}]
deps =
    --requirement test/requirements.txt
extras =
    export
    export-matlab-v5
    gui
passenv = DISPLAY,XAUTHORITY
setenv =
    DISPLAY = :0
    QT_DEBUG_PLUGINS = 1
commands =
    pytest --cov --cov-report=lcov {posargs}

[testenv:black]
deps =
    black~=25.1  # Aligned with .pre-commit-config.yaml
skip_install = true
commands =
    black --config pyproject.toml --check . asammdf.spec

[testenv:mypy]
deps =
    --requirement types-requirements.txt
    mypy~=1.14
extras =
    decode
    encryption
    export
    export-matlab-v5
    filesystem
    gui
    symbolic-math
commands =
    mypy

[testenv:ruff]
deps =
    ruff~=0.9.0  # Aligned with .pre-commit-config.yaml
skip_install = true
commands =
    ruff check

[testenv:doc]
deps =
    --requirement doc/requirements.txt
commands =
    sphinx-build --builder html --nitpicky doc doc/_build/html

[testenv:pyinstaller]
base =
deps =
    pyinstaller
    pyopengl
    canmatrix>=1.2
    ldfparser
extras =
    decode
    encryption
    export
    export-matlab-v5
    gui
    symbolic-math
commands =
    pyinstaller asammdf.spec {posargs}

[gh-actions]
python =
    3.9: py39, black, mypy, ruff, doc
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313, mypy

[pytest]
python_classes =
testpaths = test
addopts = -vv --color=yes --code-highlight=yes --junitxml=test-reports/unit-tests-results.xml
timeout = 600
